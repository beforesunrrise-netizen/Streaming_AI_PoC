# "주식도사" 챗봇 — 바이브 코딩 개발기

---

## 바이브 코딩이란?

> **"코드를 직접 짜지 않는다. AI에게 방향을 잡아주고, AI가 코딩한다."**

바이브 코딩(Vibe Coding) = 자연어로 AI에게 지시해서 소프트웨어를 만드는 개발 방식.

이 프로젝트에서는 **Claude Code(CLI)**를 사용했습니다.
터미널에서 대화하듯 지시하며, 전체 챗봇을 완성했습니다.

---

## 만들려는 것

**"주식도사"** — 다음 금융 전용 투자 Q&A 챗봇

| 항목 | 내용 |
|------|------|
| 사용자 | 초보 투자자 |
| 입력 | "삼성전자 지금 사면 좋을까?" 같은 자연어 질문 |
| 데이터 | **다음 금융(finance.daum.net)만 사용** (절대 규칙) |
| 출력 | 4단계 사고 과정 + 쉬운 답변 + 출처 링크 |
| 배포 | Streamlit Cloud (모바일 대응) |

---

## 개발 흐름 — 5단계 스토리

---

### STEP 1. AI에게 "설계도"를 건네다

바이브 코딩의 시작은 코드가 아닙니다. **규칙을 정의하는 것**입니다.

Claude Code는 프로젝트 루트의 `CLAUDE.md`를 자동으로 읽고, 모든 작업에 반영합니다.
과제 요구사항을 그대로 이 파일에 정리해서 넣었습니다.

```markdown
# 프로젝트: 주식도사 챗봇

## 핵심 규칙
- 데이터 출처: 반드시 finance.daum.net만 사용
- 4단계 사고 과정을 사용자에게 보여줄 것
- 모든 답변에 출처(다음 금융 URL) 명시
```

#### CLAUDE.md를 쓰는 이유

| 없을 때 | 있을 때 |
|---------|---------|
| 매번 "다음 금융만 써" 반복해야 함 | 한 번 쓰면 자동 인식 |
| 대화가 길어지면 초기 지시를 잊음 | 항상 참조됨 |
| AI가 규칙을 벗어날 수 있음 | 틀 안에서 일관되게 작업 |

**CLAUDE.md = AI에게 주는 프로젝트 헌법**

---

### STEP 2. 단계별로 지시해서 파이프라인 구축

한 번에 "챗봇 전체를 만들어줘"라고 하지 않았습니다.
**모듈 단위로 쪼개서, 순서대로 지시**했습니다.

---

**지시 1 → 질문 의도 분석**
```
"사용자가 '삼성전자 지금 사면 좋을까?'라고 물으면
종목명, 종목코드, 질문유형을 추출하는 intent.py를 만들어줘"
```

> 결과: "삼성전자" → 005930, 매수판단형 추출 완료

---

**지시 2 → 탐색 계획 수립**
```
"질문 유형에 따라 다음 금융에서 어떤 페이지를 볼지
계획을 세우는 planner.py를 만들어줘"
```

> 결과: 매수판단 → 시세+뉴스, 시세확인 → 시세만 조회하는 계획 로직 완성

---

**지시 3 → 데이터 수집**
```
"계획에 따라 finance.daum.net에서 데이터를 가져오는
daum_fetch.py를 만들어줘. 반드시 allowlist로 다음 금융만 허용해"
```

> 결과: 도메인 허용 목록 기반의 안전한 데이터 수집기 완성

---

**지시 4 → 요약 + 답변 생성**
```
"가져온 데이터를 요약하고, 초보 투자자가 이해하기 쉬운
최종 답변을 만드는 summarizer.py, answer.py를 만들어줘"
```

---

**지시 5 → 채팅 UI**
```
"ChatGPT처럼 대화형 UI를 만들어줘.
4단계 사고 과정을 expander로 보여주고, 모바일 대응해줘"
```

> 결과: Streamlit 기반 GPT 스타일 채팅 인터페이스 완성

---

### STEP 3. 벽에 부딪히다 — 다음 금융 접근 차단

배포 후, **핵심 문제가 터졌습니다.**

```
❌ 차트 API   → 403 Forbidden
❌ 뉴스 페이지 → 404 Not Found
❌ 공시 페이지 → 404 Not Found
❌ 토론 페이지 → 404 Not Found

✅ 시세 페이지만 겨우 살아있는 상태
```

#### 원인

1. **다음 금융은 React SPA** — JavaScript가 브라우저에서 실행돼야 페이지가 완성됨. 단순 HTTP 요청으로는 빈 페이지만 돌아옴.
2. **서버 측 접근 제한** — 클라우드 서버 IP에서의 접근 차단.

뉴스/공시/토론을 못 가져오면, 매수 판단이나 여론 확인 같은 **핵심 기능이 전부 무력화**됩니다.

---

### STEP 4. Tavily로 돌파하다

이 문제를 Claude에게 그대로 던졌습니다.

```
"다음 금융 직접 URL이 404를 반환해.
Tavily API로 finance.daum.net 안에서 실제 존재하는 URL을 검색해서
우회하는 방식으로 바꿔줘.
단, Tavily는 URL 찾는 용도로만 쓰고,
데이터는 여전히 다음 금융에서 직접 가져와야 해."
```

> Claude가 `tavily_search.py`를 만들고, `planner.py`를 수정했습니다.

---

#### Before vs After

```
[ Before — 직접 URL ]

"삼성전자 뉴스 보여줘"
  → finance.daum.net/quotes/A005930/news
  → 404 에러 ❌
  → "뉴스를 찾을 수 없습니다"


[ After — Tavily 우회 ]

"삼성전자 뉴스 보여줘"
  → Tavily: "site:finance.daum.net 삼성전자 뉴스" 검색
  → 실제 존재하는 URL 3~5개 확보
  → 해당 URL에서 데이터 수집 ✅
  → "삼성전자 관련 최신 뉴스입니다..."
```

---

#### 이중 안전장치 — "다음 금융만 사용" 규칙은 유지

```
안전장치 1: Tavily 검색 시
  → include_domains=["finance.daum.net"]
  → site:finance.daum.net 키워드 추가

안전장치 2: 데이터 수집 시
  → daum_fetch.py의 allowlist가 한 번 더 검증
  → finance.daum.net 아니면 자동 차단
```

Tavily를 도입했지만, **절대 규칙은 깨지 않았습니다.**

---

### STEP 5. UI 다듬고 배포

```
"ChatGPT처럼 깔끔한 대화형 UI로 만들어줘.
사고 과정은 접을 수 있는 expander에, 예시 질문 버튼도 넣어줘"
```

#### 완성된 화면 흐름

```
┌─────────────────────────────────┐
│  주식도사 - 다음 금융 챗봇        │
├─────────────────────────────────┤
│                                 │
│  💬 삼성전자 지금 사면 좋을까?     │
│                                 │
│  ▶ 사고 과정 보기                │
│  ┌─────────────────────────┐    │
│  │ [1] 의도 분석              │    │
│  │  종목: 삼성전자 (005930)   │    │
│  │  유형: 매수판단형          │    │
│  │                           │    │
│  │ [2] 탐색 계획              │    │
│  │  → 시세 조회              │    │
│  │  → 뉴스 검색 (Tavily)     │    │
│  │                           │    │
│  │ [3] 데이터 수집            │    │
│  │  ✅ 시세: 72,500원        │    │
│  │  ✅ 뉴스 3건 수집         │    │
│  │                           │    │
│  │ [4] 최종 답변 생성         │    │
│  └─────────────────────────┘    │
│                                 │
│  🤖 삼성전자(005930) 분석입니다.  │
│     현재가: 72,500원 (+1.35%)   │
│     ...                        │
│     📎 참고한 다음 금융 페이지    │
│     1. [시세 정보](링크)        │
│     2. [최신 뉴스](링크)        │
│                                 │
│  ─────────────────────────────  │
│  💬 뉴스 보여줘                  │
│  (종목을 기억해서 삼성전자 뉴스    │
│   자동 조회)                    │
└─────────────────────────────────┘
```

→ Streamlit Cloud 배포 완료. 모바일 브라우저에서 바로 접속 가능.

---

## 시스템 아키텍처

```
사용자 질문
    │
    ▼
┌─────────────┐
│  intent.py  │  [1] 질문 의도 분석
│             │  "삼성전자" → 005930, 매수판단형
└──────┬──────┘
       │
       ▼
┌──────────────┐
│  planner.py  │  [2] 탐색 계획 수립
│              │  직접 URL + Tavily 검색 URL
└──────┬───────┘
       │
       ▼
┌───────────────────────┐
│  daum_fetch.py        │  [3] 데이터 수집
│  + tavily_search.py   │  Allowlist 검증 후 수집
│  (finance.daum.net만) │
└──────┬────────────────┘
       │
       ▼
┌───────────────┐
│ summarizer.py │  데이터 요약
└──────┬────────┘
       │
       ▼
┌──────────────┐
│  answer.py   │  [4] 최종 답변 생성
│  + 출처 명시  │  초보 투자자용 답변 + 참고 링크
└──────┬───────┘
       │
       ▼
┌──────────────┐
│ app_chat.py  │  Streamlit 챗봇 UI
│ (모바일 대응) │
└──────────────┘
```

---

## 개발 타임라인 (Git 커밋 기준)

| Phase | 내용 | 주요 커밋 |
|-------|------|----------|
| **1. 기본 구조** | 프로젝트 초기 셋업 | `363de5e` Initial commit |
| **2. 배포 + 안정화** | Streamlit Cloud 배포, 오류 수정 | `b071b8c` 배포 설정 / `902bc23` ImportError 수정 |
| **3. 벽에 부딪힘** | 다음 금융 접근 차단 대응 | `48f975d` 데이터 수집 안정성 개선 |
| **4. Tavily 돌파** | 핵심 전환점 | `4b322c3` Tavily API 통합 |
| **5. UI 고도화** | GPT 스타일 UI, LangGraph | `d2f0dad` 대화 기능 / `a0817fc` GPT-4o 업그레이드 |

---

## 바이브 코딩에서 얻은 교훈

### 1. 규칙 정의가 코딩보다 먼저다
CLAUDE.md에 제약 조건을 명확히 써두면, AI가 그 틀 안에서 알아서 코드를 짭니다.
"다음 금융만 써야 해"를 한 번 적어두니, 이후 모든 코드가 그 규칙을 따랐습니다.

### 2. 막히면 문제를 AI에게 그대로 던져라
다음 금융 직접 접근이 막혔을 때, 에러 메시지를 그대로 복사해서 전달했습니다.
AI가 원인을 파악하고, Tavily 우회라는 대안까지 구현했습니다.

### 3. 한 번에 다 시키지 말고, 단계별로 지시하라
- "챗봇 전체 만들어줘" → 결과물 품질이 떨어짐
- "의도 분석 → 계획 수립 → 데이터 수집 → 답변 → UI" 순서로 → 각 모듈이 탄탄하게 완성됨

### 4. 배포 후 오류는 가장 좋은 피드백이다
ImportError, 403, 404 — 배포 후 터진 오류들을 AI에게 바로 던지면,
원인 분석부터 수정 코드까지 즉시 나옵니다.

---

## 파일 구조

```
키움_챗봇/
├── app_chat.py            # GPT 스타일 채팅 UI (메인)
├── intent.py              # [1단계] 질문 의도 분석
├── planner.py             # [2단계] 탐색 계획 수립
├── daum_fetch.py          # [3단계] 다음 금융 데이터 수집 (Allowlist)
├── tavily_search.py       # [3단계] Tavily URL 검색 (404 우회)
├── summarizer.py          # [3단계] 데이터 요약
├── answer.py              # [4단계] 최종 답변 생성
├── config.py              # 설정 (Allowlist, 질문유형 등)
├── endpoints.py           # 다음 금융 URL 관리
├── state.py               # 대화 상태 관리 (멀티턴)
├── stock_mapping.py       # 종목명 ↔ 종목코드 매핑
├── cache_manager.py       # 캐시 관리
├── requirements.txt       # 의존성 목록
└── .env                   # API 키 (OpenAI, Tavily)
```
